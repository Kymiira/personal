<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MathType | The Universal Math Trainer</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">

<style>
/* —— unchanged styling —— */
:root {
    --bg-color:#050505;--surface-color:#0f0f0f;--surface-hover:#161616;
    --border-color:#222;--text-primary:#f2f2f2;--text-secondary:#888;
    --accent-color:#fbbf24;--error-color:#ef4444;
    --font-main:'Roboto Mono',monospace;
    --transition:.3s cubic-bezier(.16,1,.3,1);
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:#050505;color:#f2f2f2;font-family:var(--font-main);height:100vh;display:flex;flex-direction:column;overflow:hidden}
.hidden{display:none!important}
/* (styling truncated for brevity – unchanged from your file) */
</style>
</head>

<body>
<header>
    <h1 class="menu-title">MathType Pro</h1>
    <p id="main-subtitle" class="menu-subtitle">A Comprehensive Mathematical Taxonomy</p>
</header>

<main>
    <div id="subject-menu" class="content-width"></div>
    <div id="category-menu" class="content-width hidden"></div>

    <div id="game-area" class="hidden">
        <div id="hud">
            <div id="hud-path">---</div>
            <div id="hud-score">SOLVED: 0</div>
        </div>
        <div id="math-display"></div>
        <input type="text" id="input-field" autocomplete="off" spellcheck="false" placeholder="?">
        <div style="margin-top:3rem;color:#888;font-size:.65rem;letter-spacing:2px;text-transform:uppercase;">
            [ENTER] SUBMIT • [ESC] RETURN
        </div>
    </div>
</main>

<script>
/* ==========================
   DIFFICULTY MODEL
========================== */
const Difficulty = {
    score(meta){
        let s=0;
        if(meta.operands) s+=meta.operands*1.5;
        if(meta.maxValue) s+=Math.log10(meta.maxValue+1)*2;
        if(meta.hasFractions) s+=3;
        if(meta.hasNegatives) s+=2;
        if(meta.hasExponents) s+=4;
        if(meta.steps) s+=meta.steps*2;
        return Math.round(s);
    }
};

/* ==========================
   MATH GENERATION ENGINE
========================== */
const MathGen = {
    r(min,max){return Math.floor(Math.random()*(max-min+1))+min;},

    generate(subject,catId){
        let q,ans,meta;

        if(subject==='arithmetic'){
            switch(+catId){
                case 5:{ // fractions
                    let a=this.r(1,9),b=this.r(1,9),c=this.r(1,9),d=this.r(1,9);
                    q=`frac(${a},${b}) + frac(${c},${d})`;
                    let n=a*d+c*b,den=b*d;
                    ans=`${n}/${den}`;
                    meta={operands:4,hasFractions:true,steps:3};
                    break;
                }
                case 8:{ // exponents
                    let b=this.r(2,6),e=this.r(2,3);
                    q=`${b}^${e}`;
                    ans=(b**e).toString();
                    meta={operands:2,hasExponents:true,steps:2};
                    break;
                }
                case 11:{ // modulo
                    let a=this.r(20,100),m=this.r(3,12);
                    q=`${a} mod ${m}`;
                    ans=(a%m).toString();
                    meta={operands:2,maxValue:100,steps:2};
                    break;
                }
                default:{
                    let a=this.r(1,50),b=this.r(1,50);
                    q=`${a} + ${b}`;
                    ans=(a+b).toString();
                    meta={operands:2,maxValue:50,steps:1};
                }
            }
        }

        else if(subject==='algebra'){
            let x=this.r(1,10),a=this.r(2,6);
            q=`Solve: ${a}x = ${a*x}`;
            ans=x.toString();
            meta={operands:2,steps:2};
        }

        else if(subject==='geometry'){
            let w=this.r(3,15),h=this.r(3,15);
            q=`Rectangle ${w}×${h}. Area?`;
            ans=(w*h).toString();
            meta={operands:2,maxValue:225,steps:2};
        }

        else if(subject==='trigonometry'){
            let ang=[0,30,45,60,90][this.r(0,4)];
            q=`sin(${ang}°)`;
            ans={0:'0',30:'1/2',45:'√2/2',60:'√3/2',90:'1'}[ang];
            meta={operands:1,hasFractions:true,steps:3};
        }

        else if(subject==='calculus'){
            let a=this.r(2,5);
            q=`d/dx (${a}x^2)`;
            ans=`${2*a}x`;
            meta={operands:2,hasExponents:true,steps:4};
        }

        return {
            q,
            accepted:[ans],
            difficulty:Difficulty.score(meta)
        };
    }
};

/* ==========================
   VISUALIZER (UNCHANGED)
========================== */
const Visualizer={
    render(str){
        return str
        .replace(/frac\((.*?),(.*?)\)/g,'<span class="m-frac"><span class="m-num">$1</span><span class="m-den">$2</span></span>')
        .replace(/\^(\w+)/g,'<span class="m-sup">$1</span>');
    }
};

/* ==========================
   GAME LOGIC (MINIMAL CHANGE)
========================== */
const Game={
    subject:null,catId:null,score:0,current:null,

    init(){ /* unchanged menu init */ },

    start(subject,catId){
        this.subject=subject;
        this.catId=catId;
        this.score=0;
        UI.show('game-area');
        UI.updateHUD();
        this.next();
    },

    next(){
        this.current=MathGen.generate(this.subject,this.catId);
        const d=document.getElementById('math-display');
        d.classList.remove('pulse','shake');
        d.innerHTML=Visualizer.render(this.current.q);
        const i=document.getElementById('input-field');
        i.value='';
        i.focus();
    },

    submit(){
        const v=document.getElementById('input-field').value.trim();
        if(this.current.accepted.includes(v)){
            this.score++;
            UI.updateHUD();
            document.getElementById('math-display').classList.add('pulse');
            setTimeout(()=>this.next(),300);
        }else{
            const d=document.getElementById('math-display');
            d.classList.add('shake');
            setTimeout(()=>d.classList.remove('shake'),400);
        }
    }
};

/* ==========================
   UI + BINDINGS (UNCHANGED)
========================== */
window.onload=()=>Game.init();
document.getElementById('input-field').onkeydown=e=>{
    if(e.key==='Enter')Game.submit();
    if(e.key==='Escape')UI.showCategories(Game.subject);
};
</script>
</body>
</html>
